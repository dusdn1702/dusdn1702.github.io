---
title: "네트워크 부수기"
excerpt: cs
permalink: /study/48
categories:
  - techcourse
tags:
  - techcourse

last_modified_at: 2021-06-27
---  

### [Network] 네트워크 관점에서의 웹 동작 방식  
인터넷이란? 컴퓨터들이 서로 통신할 수 있는 거대한 네트워크로 물리적/무선으로 연결되어야 한다.  
하나씩 연결이 복잡해지는 것을 해결하기 위해 라우터 사용, 모든 것을 라우터에 보내고 라우터로부터 받는다. 라우터들도 추가해 라우터간 연결, 라우터를 통한 컴퓨터 연결이 된다.  
네트워크를 ISP에 연결, ISP는 라우터를 관리하고, 다른 ISP에도 접근할 수 있다. 우리가 보내는 네트워크의 메시지는 ISP 네트워크의 네트워크를 통해 전달   


1. 브라우저는 dns로 접속을 요청한다.  
- 인터넷 서비스 제공업체(ISP)가 관리하는 DNS 해석기로 라우팅  
라우팅이란? 라우터, 브릿지, 게이트웨이, 방화벽, 스위치와 같은 중간 지점을 거쳐 출발지부터 목적지까지 효율적으로 패킷의 전달을 하는 것  
라우터란? 서로 다른 네트워크 간의 경로를 정해 패킷을 전달하는 장치, 네트워크 계층  
브릿지란? 세그멘트를 연결하고 패킷을 전송하는 장비, LAN 간 전송, MAC, 데이터 링크 계층  
스위치란? 허브처럼 포트에 들어온 것을 잘 나눠서 다른 포트로 전송하는 장치, IP+MAC, 데이터 링크 계층  
게이트웨이란? 네트워크가 어디로 전송해야할지 연결해주는 장치, OSI 전계층  
- ISP의 DNS 해석기가 요청을 DNS 루트 이름 서버에 전달해서 IP 주소 확보    
도메인명은 트리 구조로 되어있다.  
호스트명.제 3레벨 도메인(도메인명).제 2레벨 도메인.제 1레벨 도메인
DNS 서버는 LAN 안에 있는 클라이언트로부터 조회 받아 클라이언트 대신 인터넷에 조회해주는 캐시 서버, 외부 호스트로부터 자신이 관리하는 도메인(zone 파일이란 db에서 관리) 조회받는 콘텐츠 서버로 나뉜다. 캐시서버가 트리의 오른쪽부터 도메인명 관리하는 서버 찾아 ip주소 알려주는 것이 `이름 해결`  
이 dns 서버는 tcp, udp [둘 다 사용](https://docs.microsoft.com/ko-kr/troubleshoot/windows-server/networking/dns-works-on-tcp-and-udp)   


2. 브라우저는 서버에게 웹사이트 사본을 달라는 HTTP 요청 메시지 만든다.  
- http 요청 헤더  
GET / HTTP/1.1 : HTTP전송 방법과 프로토콜 버전  
Host: 요청하는 서버 주소  
User-Agent: OS/브라우저 정보  
Accept: 클라이언트 이해 가능한 컨텐츠 타입  
Accept-Language: 클라이언트 인식 언어  
Accept-Encoding: 클라이언트 인코딩 방법  
Connection: 전송 완료후 접속 유지 정보 (keep-alive)  
Upgrade-Insecure-Requests:신호를 보낼때 데이터 암호화 여부  
Content-Type: 클라이언트에게 반환되어야하는 컨텐츠 유형  
Content-Length: 본문크기  

3. 메시지를 서버로 전송, 이 때 브라우저는 서버와 TCP 커넥션을 맺는 것과 같은 TCP/IP 연결을 통해 전송됨  
[참고](https://better-together.tistory.com/110)  
[패킷 구경](https://codetronik.tistory.com/88)  
- TCP/IP란?  
OSI 계층에서 통용적으로 사용되는 계층  
인터넷과 관련된 다양한 프로토콜의 집합(IEEE, DNS, HTTP, TCP, IP, ICMP ...)으로 일반적인 네트워크를 동작시킨다.  

    - application layer  
    File Transfer Protocol, DNS, HTTP와 같이 유저에게 제공되는 어플리케이션에서 사용하는 통신의 움직임을 제어하는 계층  
    HyperText Transfer Protocol + Domain Name System: 클라이언트(웹 브라우저) <-> 서버  
    
    - transport layer  
    Transmission Control Protocol, User Data Protocol과 같이 어플리케이션 계층에 네트워크로 접속되어 있는 두 대의 컴퓨터 사이의 데이터 흐름 제공  
    TCP: 큰 데이터를 보내기 쉽게 TCP 세그먼트란 단위 패킷으로 작게 분해해 관리하는 것(바이트 스트림 서비스)을 제공하는 것으로 데이터를 분해해 보내고 잘 갔는지 확인하는 역할  
    three way handshaking이라는 방법을 사용해 데이터를 전송하고 이중 하나라도 실패하면 다시 전송    
    ```
    송신측은 SYN 플래그로 상대에게 접속함과 동시에 패킷을 보냄  
    수신측은 SYN/ACK 플래그로 송신측에 접속함과 동시에 패킷 수신  
    송신측이 ACK 플래그를 보내 완료 확인
    ```

    - network layer  
    네트워크 상에서 이동 경로를 포함해 패킷(전송하는 데이터의 최소 단위)의 이동 제어  
    Internet Protocol(IP): 패킷을 상대방에게 전달(Media Access Control Address는 각 네트워크 카드에 할당된 고유의 주소)  
    IP 통신은 다음 중계할 곳인 MAC 주소를 찾아가며 이루어진다. MAC은 변하지 않는다.  
    목적지를 찾아가면서도 Address Resolution Protocol이 사용되는데 이는 수신지의 IP 주소를 바탕으로 MAC 주소 찾는다.  

    - link layer  
    하드웨어 측면으로 디바이스 드라이버, Network Interface Card와 같은 물리적인 부분  

송신 계층을 거칠 때마다 헤더를 더해 캡슐화 하고, 수신 계층을 거칠때마다 헤더를 삭제하며 데이터 전달  
`송신 ---HTTP message--->  HTTP data ---TCP segment---> +TCP header ---IP datagram---> +IP header ---network frame---> +Ethernet header`  

- World Wide Web을 구성하는 HyperText Markup Language  
- `Uniform Resource Identifier`는 `Uniform Resource Locator`의 서브셋으로 차례대로 `스키마, 자격정보, 서버주소, 서버포트, 계층적 파일 경로, 쿼리 문자열, 프래그먼트 식별자` 전달  

- HTTP 요청  
HTML 문서 같은 리소스들을 가져올 수 있도록 해주는 프로토콜(데이터 교환 방식을 정하는 규칙의 집합, 헤더, 메서드, 바디 등등)  
    - response 헤더  
    HTTP/1.1 200 ok : 프로토콜 버전과 응답상태  
    Access-Control-Allow-Origin: 서버에 타 사이트의 접근을 제한하는 방침  
    Connection: 전송 완료후 접속 유지 정보 (keep-alive)  
    Content-Encoding: 미디어 타입을 압축한 방법  
    Date: 헤더가 만들어진 시간  
    ETag: 버전의 리소스를 식별하는 식별자  
    Keep-Alive: 연결에대한 타임아웃과 요청 최대 개수 정보  
    Last-Modified: 웹 시간을 가지고 있다 수정되었을때만 데이터 변경 ( 캐시연관 )  
    Server: 웹서버로 사용되는 프로그램 이름  
    Set-Cookie: 쿠키 정보  
    Transfer-Encoding: 인코딩 형식 지정  
    X-Frame-Options: frame/iframe/object 허용 여부  
    - 바디  

4. 서버는 클라이언트의 요청을 받아 처리하고, 그에 따른 HTTP 응답 메시지를 작성한다.  
- 데이터 처리 과정  
Controller <-> Service <-> Repository <-> DB  

5. 서버는 클라이언트와 TCP 연결을 맺는다.  

6. 메시지를 전송한다.  

7. 연결을 close하면 클라이언트는 http 바인딩  


## [Network] Application layer  
  
### 응용계층 프로토콜과 그 역할  
원격 접속, 파일 전송, 전자 메일, 네트워킹 지원, 호스트 초기화, 원격 호스트 관리  

- socket programming  
소켓은 프로세스가 데이터를 보내거나 받기 위해 데이터를 쓰거나 읽는 것  
protocol, ip 주소, port number로 정의  
떨어져있는 server socket, client socket의 통신  

application layer에서 socket을 통해 tcp/udp로 가는 것  
SOCK_STREAM: TCP 소켓  
SOCK_DGRAM: UDP 소켓  
server의 
socket(): socket 생성 -> 
bind(): ip와 port번호 설정 -> 
listen(): 수신 대기열을 만들어 몇 개의 클라이언트 대기시킬지 결정 ->  
accept(): client connection 올떄까지 block  

client의 
socket(): 소켓을 연다 ->  
connect(): 통신할 서버의 설정된 ip와 port 번호에 통신 시도 ->  
accept(): 서버가 클라이언트의 socket descriptor 반환 ->  
write() -> read() -> close()  

- HTTP  
http는 서버와 클라이언트 간 통신을 한다.  
request와 response는 상호 교환된다.  
request: 메서드, uri, 프로토콜 버전, 옵션 리퀘스트 헤더필드, 엔티티  
response: 프로토콜 버전, 상태 코드, 옵션 리스펀드 헤더필드, 바디  
http는 상태를 유지하지 않는 프로토콜  
리퀘스트 uri로 리소스를 식별  

    - GET: 리소스 획득  
    - POST: 엔티티 전송  
    - PUT: 파일 전송  
    - HEAD: 메시지 헤더 취득  
    - DELETE: 파일 삭제  
    - OPTIONS: 제공하고 있는 메서드의 문의  
    - TRACE: 경로조사  
    리퀘스트 보낸 곳에 어떤 리퀘스트가 가공되어 있는지 조사(크로스 사이트 트레이싱 보안 문제)  
    - CONNECT: 프록시에 터널링 요구  
    서버에서 클라이언트 직접 연결되면 http, tls 이용한 연결되면 https, https를 위한 프록시를 통하는 것을 CONNECT 메서드를 통함  

    - 지속 연결로 접속량 절약  
    하나 보낼때마다 tcp 연결과 종료를 하여 통신량 증가  
    지속 연결이란 어느 한쪽이 명시적으로 연결을 종료하지 않는 이상 tcp 연결을 유지하는 것  
    tcp 연결과 종료를 반복하지 않아 서버에 대한 부하 경감  

    - 파이프라인화  
    리퀘스트 송신 후에 리스폰스까지 기다리다가 리퀘스트를 발행하던 것을 리스펀스를 기다리지 않고 다음 리퀘스트를 보낼 수 있도록 한다.  

    - 쿠키를 통한 상태 관리  
    stateless 프로토콜은 cpu나 메모리 같은 리소스의 소비 억제  
    상태를 기록하기 위한 쿠키가 만들어짐  

- TELNET  
인터넷, 로컬 영역 네트워크 연결에 사용  
23번 포트를 사용하는 것  
터미널 에뮬레이션 프로토콜인 NVT 사용  
보안이 추가된 것이 SSH  

- FTP  
TCP/IP 프로토콜을 가지고 서버와 클라이언트 사이의 파일 전송 담당  
20번 포트(데이터), 21번 포트(제어)를 사용하는 것  
Active : client가 21번 포트에 요청 전송 -> server가 요청 수신 -> 답신 -> server가 20번 채널에서 데이터 전송 -> client가 요청 수신 -> 답신  
Passive : client가 21번 포트에 요청 전송 -> server가 요청 수신 -> 답신 -> client가 임시 채널에 데이터 전송 -> server가 요청 수신 -> 답신  
더 간단하게 UDP 기반으로 파일 전송하는 것이 TFTP, 69번 포트 사용  

- SMTP  
TCP 25번 포트를 이용해 이메일을 보내기 위한 간이 전자 우편 전송 프로토콜  
모든 문자가 7bit ASCII로 되어 있어야 한다.  
POP3, IMAP와 함께 사용되어 서버 메일함에 저장하고 서버에서 주기적으로 메시지 다운로드  
POP3 서버에 등록된 계정이 있어야 한다.(이메일주소)  
```
S: 220 smtp.example.com ESMTP Postfix
C: HELO relay.example.org
S: 250 Hello relay.example.org, I am glad to meet you
C: MAIL FROM:＜bob@example.org＞
S: 250 Ok
C: RCPT TO:＜alice@example.com＞
S: 250 Ok
C: RCPT TO:＜theboss@example.com＞
S: 250 Ok
C: DATA
S: 354 End data with ＜CR＞＜LF＞.＜CR＞＜LF＞
C: From: "Bob Example" ＜bob@example.org＞
C: To: "Alice Example" ＜alice@example.com＞
C: Cc: theboss@example.com
C: Date: Tue, 15 January 2008 16:02:43 -0500
C: Subject: Test message
C:
C: Hello Alice.
C: This is a test message with 5 header fields and 4 lines in the message body.
C: Your friend,
C: Bob
C: .
S: 250 Ok: queued as 12345
C: QUIT
S: 221 Bye
{The server closes the connection}
```  

- DNS  
DNS 리커서: 애플리케이션을 통해 클라이언트 컴퓨터로부터 쿼리를 받도록 고안된 서버  
루트 이름 서버: 호스트 이름을 IP 주소로 변환하는 첫 단계, 특정 위치에 대한 참조로 사용  
TLD(최상위 도메인) 이름 서버: 호스트 이름의 마지막 부분 호스팅  
권한 있는 이름 서버: 최종 IP 주소를 dns 리커서에 반환  
[참고](https://www.cloudflare.com/ko-kr/learning/dns/what-is-dns/)  

- BOOTP  
TCP/IP에서 자동 부팅을 위한 최초의 표준프로토콜  
IP주소, 부트 파일이 있는 서버 이름, 부트 파일 이름 세 정보를 제공받는다.  
진보된 DHCP를 더 많이 사용한다.  
IP address, subnet mask address, DNS address, gateway address 와 같은 네트워크 그룹에 가입하기 위해 필요한 정보나, domain상에서 통용되는 터미널의 이름을 전달해 준다.

- SNMP  
라우터, 스위치, 서버 등을 이용해 IP 네트워크 장치로부터 정보를 수집, 관리, 수정하는 데에 사용되는 프로토콜  
컴퓨터 네트워크에서 호스트나 장치들의 그룹을 관리하는 일 수행  
managed device(노드에 특화된 정보에 대한 접근 허용), agent(네트워크 관리 소프트웨어 모듈), Network management Station(디바이스 감시하고 제어하는 어플리케이션 실행)  

Remote host management: Simple Network Management Protocol (SNMP), Common Management Information Protocol over TCP (CMOT)

소켓 vs http?
포트의 역할?  
subnet mask??